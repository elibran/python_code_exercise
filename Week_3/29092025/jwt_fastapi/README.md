# project_updated

A FastAPI-based project with JWT authentication and authorization.

> _Autogenerated comprehensive README on 2025-09-11. This guide is beginner-friendly and includes step‚Äëby‚Äëstep instructions for Windows and macOS/Linux._

---

## ‚ú® Overview

This project exposes a RESTful API using **FastAPI**, secured with **JWT** (JSON Web Tokens). It includes endpoints for authentication (login/refresh) and protected resources. You can run it locally via **Uvicorn** or containerize it with Docker.

---

## üóÇ Project Structure

```
project_updated/
‚îú‚îÄ (source code)
‚îú‚îÄ docs/
‚îÇ  ‚îî‚îÄ diagrams/                 # PlantUML diagrams (added)
‚îú‚îÄ README.md                    # This file (added/updated)
‚îú‚îÄ requirements.txt / pyproject.toml
‚îî‚îÄ ...
```

### Key Python files touching the API

 - `jwt-fastapi/app/deps.py`
 - `jwt-fastapi/app/main.py`
 - `jwt-fastapi/app/routers/accounts.py`
 - `jwt-fastapi/app/routers/auth.py`

---

## üîß Prerequisites

- **Python 3.10+** (recommend 3.11)
- **Git**
- (Optional) **Docker** & **Docker Compose**
- (Optional) **Make** on macOS/Linux or **PowerShell** on Windows

---

## üöÄ Quick Start

### 1) Clone & enter the project

**macOS/Linux (bash/zsh):**
```bash
git clone <your-repo-url>.git
cd project_updated
python -m venv .venv && source .venv/bin/activate
```

**Windows (PowerShell):**
```powershell
git clone <your-repo-url>.git
cd project_updated
python -m venv .venv; .\.venv\Scripts\activate
```

### 2) Install dependencies

If using **requirements.txt**:
```bash
pip install -r requirements.txt
```

If using **pyproject.toml** (Poetry):
```bash
pip install poetry
poetry install
poetry shell
```

> Auto-detected dependencies:
```
- PyJWT
- fastapi
- passlib[bcrypt]
- python-jose[cryptography]
- uvicorn[standard]
```

### 3) Environment variables

Create a `.env` file in the project root:

```
# Security
SECRET_KEY="change-me"
ALGORITHM="HS256"
ACCESS_TOKEN_EXPIRE_MINUTES=30

# App
ENV="local"
DEBUG=true
```

Also present/used in code:
```
- ACCESS_TOKEN_EXPIRE_MINUTES
- ALGORITHM
- SECRET_KEY
```

### 4) Run the API

**macOS/Linux (bash/zsh):**
```bash
uvicorn app.main:app --reload
```

**Windows (PowerShell):**
```powershell
uvicorn app.main:app --reload
```

API will start at **http://127.0.0.1:8000**  
Docs will be available at **/docs** (Swagger UI) and **/redoc**.

---

## ‚úÖ Verify the project (step‚Äëby‚Äëstep)

Below is a minimal end‚Äëto‚Äëend flow to verify JWT auth:

1. **Start the server** (as shown above).
2. **Open Swagger UI** at `http://127.0.0.1:8000/docs`.
3. **Create a user** (if the project supports signup) or use the provided seed credentials.
4. **Login to get an access token** via the `/login` endpoint.
5. **Call a protected endpoint** with the `Authorization: Bearer <token>` header.
6. **(Optional) Refresh the token** using `/refresh` if available.

**CLI verification (macOS/Linux):**
```bash
# Login
curl -X POST http://127.0.0.1:8000/login \
  -H "Content-Type: application/json" \
  -d '{"username":"abinash","password":"password"}'

## Other User & password with roles for verification purpose  
_users = {
    "abmishra": {"username":"abmishra","hashed":hash_password("password"),"role":"admin"},
    "abinash": {"username":"abinash","hashed":hash_password("password"),"role":"customer"},
    "rahul": {"username":"rahul","hashed":hash_password("password"),"role":"admin"},
    "rahul1": {"username":"rahul1","hashed":hash_password("password"),"role":"customer"},
    "arun": {"username":"arun","hashed":hash_password("password"),"role":"admin"},
    "admin": {"username":"admin","hashed":hash_password("password"),"role":"admin"},
}

# Use the token (replace TOKEN)
curl http://127.0.0.1:8000/protected \
  -H "Authorization: Bearer TOKEN"
```

**CLI verification (Windows PowerShell):**
```powershell
# Login
$body = '{"username":"abinash","password":"password"}'
Invoke-RestMethod -Method Post -Uri "http://127.0.0.1:8000/login" -ContentType "application/json" -Body $body

# Use the token (replace TOKEN)
$Headers = @{ Authorization = "Bearer TOKEN" }
Invoke-RestMethod -Method Get -Uri "http://127.0.0.1:8000/protected" -Headers $Headers
```

> Replace `/login`, `/protected`, and `/refresh` with the actual endpoints found below.

---

## üìö API Endpoints (auto‚Äëdetected)

| Method | Path | Handler | Source |
|---|---|---|---|
| GET | `/admin/{account_id}` | `` | `jwt-fastapi/app/routers/accounts.py` |
| GET | `/health` | `health` | `jwt-fastapi/app/main.py` |
| POST | `/token` | `` | `jwt-fastapi/app/routers/auth.py` |
| GET | `/{account_id}` | `` | `jwt-fastapi/app/routers/accounts.py` |

> If this table looks sparse, consult the Swagger UI for the full list ‚Äî it‚Äôs generated directly from your code.

---

## üîê FastAPI + JWT: How it works (Authentication & Authorization)

### What is JWT?
JWT (JSON Web Token) is a compact, signed token that proves a user‚Äôs identity. It typically contains:
- **Header**: algorithm & token type (e.g., `HS256`, `JWT`)
- **Payload**: claims (e.g., `sub` for subject/username, `exp` for expiry)
- **Signature**: cryptographic signature (e.g., HMAC‚ÄëSHA256)

### Typical flow
1. **Authenticate**: Client sends credentials to `/login`.
2. **Issue Token**: Server validates credentials and returns a signed JWT with `sub`, `iat`, `exp`, and possibly roles/permissions.
3. **Authorize**: Client includes `Authorization: Bearer <token>` when calling protected endpoints.
4. **Validate**: Server verifies signature, expiry, and claims; then grants access.
5. **Refresh (optional)**: A refresh token renews access without asking for the password again.

### Implementation in this project
- **Libraries**: PyJWT, passlib, python-jose
- **Key env vars**: `ACCESS_TOKEN_EXPIRE_MINUTES, ALGORITHM, SECRET_KEY`
- **Critical settings**:
  - `SECRET_KEY`: used to sign tokens ‚Äî keep it private.
  - `ALGORITHM`: e.g., HS256 for symmetric signing.
  - `ACCESS_TOKEN_EXPIRE_MINUTES`: short lifetime reduces risk.
- **Security tips**:
  - Use HTTPS in production.
  - Store tokens securely (in-memory or secure storage; avoid localStorage if possible for web apps).
  - Set short access token TTL and rotate refresh tokens.
  - Validate `aud`/`iss` when applicable.
  - Scope/role‚Äëbased checks at route level (e.g., `Depends` on an auth dependency).

### Example: creating & verifying tokens (PyJWT)
```python
from datetime import datetime, timedelta, timezone
import jwt

def create_access_token(data: dict, secret: str, algorithm: str = "HS256", minutes: int = 30):
    to_encode = data.copy()
    expire = datetime.now(tz=timezone.utc) + timedelta(minutes=minutes)
    to_encode.update({"exp": expire})
    return jwt.encode(to_encode, secret, algorithm=algorithm)

def verify_token(token: str, secret: str, algorithms: list[str] = ["HS256"]):
    payload = jwt.decode(token, secret, algorithms=algorithms)
    return payload  # raises jwt.ExpiredSignatureError, jwt.InvalidTokenError on failure
```

---

## üß™ Testing

If the repo contains tests:
```bash
pytest -q
```

Otherwise, you can create a quick smoke test using `httpx` or curl following the verification steps above.

---

## üê≥ Docker (optional)

Create `Dockerfile`:
```Dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
EXPOSE 8000
CMD ["uvicorn", "jwt-fastapi.app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

Build & run:

**macOS/Linux:**
```bash
docker build -t project_updated:dev .
docker run --rm -p 8000:8000 --env-file .env project_updated:dev
```

**Windows PowerShell:**
```powershell
docker build -t project_updated:dev .
docker run --rm -p 8000:8000 --env-file .env project_updated:dev
```

---

## üîé Troubleshooting

- **`ModuleNotFoundError`**: Ensure your venv is active and dependencies installed.
- **`Address already in use`**: Another process uses port 8000; change `--port`.
- **`401 Unauthorized`**: Ensure you pass `Authorization: Bearer <token>` and the token isn‚Äôt expired.
- **CORS issues** (for browser apps): Configure `CORSMiddleware` in FastAPI.

---

## üìÑ License

Add your license here (e.g., MIT) if applicable.

---

## üôå Credits

Built with ‚ù§Ô∏è using **FastAPI** and **Uvicorn**.
